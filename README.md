# CYOA 文字冒险游戏插件

<p align="center">
  <strong>Ada Chat 插件 — 一个功能极其丰富的 AI 驱动互动叙事引擎</strong>
</p>

<p align="center">
  <img src="https://img.shields.io/badge/version-2.1.0-10b981" alt="Version">
  <img src="https://img.shields.io/badge/license-MIT-blue" alt="License">
  <img src="https://img.shields.io/badge/i18n-简体中文-orange" alt="i18n">
  <img src="https://img.shields.io/badge/systems-43+-purple" alt="Systems">
</p>

---

## 概述

CYOA（Choose Your Own Adventure）是一个为 [Ada Chat](https://ada-fm.com) 打造的全功能互动叙事游戏插件。它结合了 **AI 驱动的动态剧情生成** 与 **精密的物理模拟系统**，让你可以在浏览器中创建和游玩高度自定义的文字冒险游戏。

插件包含 **43+ 个互相联动的子系统**，从 RPG 基础（属性/物品/装备/技能/任务）到复杂的物理约束模拟、感官过滤、乳胶封闭系统等，所有系统都通过 AI 实时织入叙事文本。

---

## 目录

- [核心特性](#核心特性)
- [系统详解](#系统详解)
  - [AI 叙事引擎](#1-ai-叙事引擎)
  - [游戏编辑器](#2-游戏编辑器)
  - [RPG 基础系统](#3-rpg-基础系统)
  - [约束与束缚系统](#4-约束与束缚系统)
  - [感官模拟系统](#5-感官模拟系统)
  - [生理状态系统](#6-生理状态系统)
  - [乳胶封闭系统](#7-乳胶封闭系统)
  - [角色扮演系统](#8-角色扮演系统)
  - [训练与纪律系统](#9-训练与纪律系统)
  - [打击与温度系统](#10-打击与温度系统)
  - [监控系统](#11-监控系统)
  - [存储与安全](#12-存储与安全)
  - [国际化](#13-国际化)
- [安装](#安装)
- [文件结构](#文件结构)
- [后端 API](#后端-api)
- [游戏数据格式](#游戏数据格式)
- [配置](#配置)
- [许可证](#许可证)

---

## 核心特性

| 类别 | 亮点 |
|------|------|
| **AI 引擎** | 流式响应、RAG 知识库、滚动摘要记忆、Token 预算管理、7 条结构化 AI 行为规则 |
| **编辑器** | 可视化创建 9 类游戏元素、14 个编辑器分节、动态联动表单 |
| **RPG** | 属性 / 物品（10 类）/ 装备（25 部位）/ 技能（6 类 9 级）/ 任务（6 类）/ 职业（20 预设）/ 章节推进 |
| **约束** | 10 种约束类型 × 25 装备部位 × 5 种材质 × 6 级锁定，完整的挣扎/降级/逃脱机制 |
| **感官** | 5 种视觉限制、6 种耳部装置、11 种口塞、5 种手指约束，AI 输出实时感官过滤 |
| **状态** | 兴奋度 / 羞耻 / 氧气 / 痛感 / 温度 / 恐慌 / 身份侵蚀 / 习惯度 — 全部多级阈值 |
| **乳胶** | 13 个子系统：厚度 / 覆盖 / 热量 / 汗液 / 自紧 / 颜色 / 开口 / 层叠 / 护理 / 导电 / 液态 / 气味 |
| **角色扮演** | PetPlay（5 角色）/ PonyPlay / 家具化（6 角色）/ 身份侵蚀（5 级物化） |
| **训练** | 6 种训练类型、9 条纪律规则、惩罚/奖励系统、习惯度与戒断效应 |
| **监控** | CCTV 警戒系统，4 级警觉度，NPC 安保介入机制 |
| **存储** | 服务端 API 优先 + localStorage 自动回退、多端点自动探测 |
| **i18n** | 330+ 翻译键，完整简体中文支持 |

---

## 系统详解

### 1. AI 叙事引擎

#### 流式响应与上下文管理
- **SSE 流式解码**：AI 逐句生成，实时渲染到聊天界面
- **三级模型回退**：DOM 选择器 → 全局变量 → 模型列表首项
- **Token 预算管理**：系统 Prompt ≤4200 字符，历史 ≤2800，单消息 ≤400

#### RAG 知识库
- 静态知识一次性生成，缓存在存档中（`_ragCache`）
- 自动包含：世界观、角色档案、装备目录、物品清单、章节总览、任务、场景、约束规则
- 游戏数据变更后自动失效重建

#### 动态 Prompt 构建
每轮对话实时注入当前游戏状态快照，包括：
- 角色属性 / 技能（含等级缩放倍率）
- 装备状态（锁定等级 / 耐久 / 降级 / 材质）
- 所有约束效果的详细叙述指令
- 兴奋度 / 习惯度 / 姿势不适 / 牵引 / 纪律规则
- 乳胶封闭 / 身份侵蚀 / 恐慌 / 呼吸管 / 导电 / PetPlay / 家具化
- 步态限制 / 头颈约束 / 手指约束 / 耳部装置
- 章节流程 / 监控系统 / 任务进度

#### 多层记忆系统
- **近期对话**：保留最近 6 轮完整对话
- **滚动摘要**：对话积累 8 轮后自动压缩历史（AI 优先，本地后备）
- **章节纪要**：切换章节时自动生成
- **关键事件日志**：上限 25 条，涵盖装备穿脱、任务完成、技能升级等

#### 敏感词双向过滤
- **150+ 条过滤规则**：覆盖身体部位、体液、动作、器具、关系等
- **双向替换**：发送前敏感词 → 安全词，接收后安全词 → 敏感词
- **可自定义**：支持用户添加/导入/导出过滤规则

---

### 2. 游戏编辑器

大型模态框编辑器，14 个分节，支持创建和编辑 **9 类游戏元素**：

| 元素 | 可配置项 |
|------|----------|
| **属性** | 名称、数值、最小值、最大值、描述 |
| **物品** | 10 种类型、数量、耐久度、锁定/解锁、附带技能、消耗物品、属性效果 |
| **装备** | 25 部位多选、5 种材质、10 种约束效果、6 级锁定、不可破坏标记、限步参数、口塞/耳部/手指约束类型、附件系统（20 种附件类型）、姿势标签 |
| **职业** | 20 种预设、图标、特征、关联技能、属性修正 |
| **技能** | 6 种类型、5 种解锁方式、9 级等级、熟练度、效果、属性需求、消耗物品 |
| **任务** | 6 种类型、5 种状态、多目标、多奖励、解锁条件 |
| **角色** | 性别、角色类型（可扮演/NPC/叙述者）、职业、技能、性格/爱好/背景/目标、AI 设定 Prompt、纪律规则、惩罚/奖励偏好、训练课程 |
| **场景** | 位置、布局装饰、可交互设施（含锚点系统）、关联任务 |
| **章节** | 排序、解锁条件、包含场景、推进条件（任务/物品/属性检查）、初始姿势/牵引预设、监控区域标记 |

**编辑器辅助功能**：
- 10+ 种表单联动行为（约束选择联动参数面板、附件类型联动子字段等）
- 世界观设定（时代背景 / 地理 / 阵营 / 社会结构 / 历史）
- 核心机制选择（回合制 / 实时 / 探索 / 解谜 / 自定义）
- 叙述者设定（11 种预设风格、AI 模型选择、叙述者 Prompt）
- 判定规则（判定方法、成功/失败规则、自定义规则）
- 规则说明书导入（纯文本解析 8 大系统）

---

### 3. RPG 基础系统

#### 物品系统
- **10 种物品类型**：钥匙、地图、治疗、伤害、消耗品、燃料、修复工具、普通、剧情、装备
- 数量上限 99，支持耐久度、锁定/解锁机制
- AI 自动解析物品变化（正则匹配"消耗了/获得了/耐久下降"）

#### 装备系统
- **25 个装备部位**：覆盖全身（头→足），含性别专属部位
- **5 种材质模板**：乳胶（光滑紧致）、金属（冰冷沉重）、绳索（粗糙勒紧）、皮革（柔韧微温）、织物（柔软透气）
- 每种材质定义触感、声音、物理抗性，影响挣扎成功率和耐久损伤
- **6 级锁定**：未锁定 → 简易锁 → 普通锁 → 精密锁 → 魔法封印 → 永久锁死

#### 技能系统
- **6 种技能类型**：魔法、武技、被动、制作、社交、特殊
- **9 级等级**：入门 → 初学 → 熟练 → 精通 → 大师 → 宗师 → 传说 → 史诗 → 神话
- 每级 100 熟练度，AI 回复自动检测技能名并增加熟练度
- 效果缩放：`1 + (level-1) × 0.15`，消耗递减：`max(0.3, 1 - (level-1) × 0.08)`

#### 任务系统
- **6 种任务类型**：主线、支线、日常、周常、随机、可重复
- **5 种状态**：未解锁 → 可接取 → 进行中 → 已完成 → 已失败
- AI 文本自动检测任务关键词，触发解锁/目标完成/奖励发放

#### 职业系统
- **20 种预设职业**：战士、法师、游侠、盗贼、治疗师、铁匠、商人、学者、刺客、骑士、吟游诗人、炼金术士、猎人、牧师、死灵法师、召唤师、武僧、贵族、农民、探险家

#### 章节推进
- 3 种推进条件：完成任务、拥有物品、属性检查（5 种比较运算符）
- 切换章节时自动：标记旧章节完成、生成纪要、应用初始姿势/牵引预设、UI 横幅通知

---

### 4. 约束与束缚系统

#### 10 种约束类型

| 约束 | 效果 |
|------|------|
| `blind` | 完全目盲，视觉描写全删 |
| `vision_restricted` | 视野受限（微孔/多孔/半透明/固定视野） |
| `mute` | 禁言，过滤说话选项 |
| `deaf` | 耳聋，听觉描写删除 |
| `limited_step` | 限步（3 级：轻度 >50cm / 中度 20-50cm / 重度 <20cm） |
| `no_hands` | 缚手，禁止所有手部操作 |
| `no_fingers` | 手指约束，禁止精细操作 |
| `chastity` | 贞操锁，阻止释放 |
| `tethered` | 牵引，限制移动 |
| `forced_open_mouth` | 强制张口，激活口水系统 |

每种约束均配有：通用文字描写、身体自动反应池、材质融合旁白（5 种材质）、约束下通用选项（含属性修正）。

#### 挣扎与逃脱机制
- **成功率计算**：基础 30% × 锁定等级惩罚 × 材质抗性 × 液态乳胶额外抗性 × 汗液滑脱加成 × 恐慌肾上腺素加成 × 缚手惩罚
- **耐久降级**：挣扎造成装备耐久下降，触发降级效果（限步步幅放宽、视野裂缝）
- **部位依赖**：大部分部位需要先解放手掌/手腕
- **AI 自动挣扎检测**：从 AI 文本中正则匹配挣扎关键词，自动触发对应槽位

#### 姿势系统
**27 种姿势**，分 5 类：
- **基础姿势** (9)：站立、跪姿、坐姿、俯卧、仰卧、悬空、蹲伏、弯腰、反缚
- **高级束缚** (8)：后手单手套、观音缚、背吊缚、大字缚、球缚、蛙缚、木乃伊缚、乳胶睡袋
- **PetPlay** (4)：四肢着地、宠物坐姿、乞食姿势、趴伏
- **PonyPlay** (3)：小马站姿、小马快步、小马展示
- **家具化** (4)：人体桌子、人体脚凳、人体衣架、人体灯架

每种姿势含专属约束效果和详细体感描写。

#### 牵引系统
- **4 种牵引类型**：NPC 牵引、固定锚点、悬吊、短链束缚
- **5 种链条长度**：牵引绳 / 短链 / 中链 / 长链 / 无链
- **6 种 D 环位置**：正面 / 背面 / 顶部 / 左右 / 底部
- **5 种锚点高度**：地面（强制俯卧）→ 天花板（强制悬空）

#### 步态系统
- **7 种步态**：正常 (1.0x) → 谨慎 (0.8x) → 碎步 (0.5x) → 蹒跚 (0.3x) → 摇晃踮脚 (0.25x) → 无助 (0.1x) → 完全不动 (0x)
- 每种含跌倒概率和叙事描写
- **11 种装备姿势标签**：强制挺直 / 强制踮脚 / 限制弯腰 / 限制屈膝 / 限制步幅 等
- **姿势阻止机制**：装备标签组合可禁止特定姿势

---

### 5. 感官模拟系统

#### 视觉系统
5 种视觉限制，按严重度排列：

| 类型 | 严重度 | AI 文本过滤效果 |
|------|--------|----------------|
| 完全目盲 | 5 | 删除所有视觉描写句 |
| 微孔视野 | 4 | 70% 改写为碎片化视觉，30% 吞掉 |
| 多微孔 | 3 | 万花筒碎片化改写 |
| 固定视野 | 3 | 删除余光/身后/侧面/环顾句 |
| 半透明 | 2 | 70% 添加朦胧前缀，30% 保留但补模糊后缀 |

每种视野类型配有独立的感官描述、身体反应池、AI 提示注入。

#### 听觉系统
- **6 种耳部装置**：耳塞、降噪耳机、单向耳机（仅控制者可闻）、白噪声耳机、音乐耳机、通透耳机
- **3 种模式**：完全静音、仅听控制者、通透
- AI 文本自动过滤"听见/声音"等句子

#### 口塞系统
- **11 种口塞**：口球、开口器、蜘蛛口枷、衔铁、面板口塞、漏斗口塞、充气口塞、牙科开口器、勒口布、模拟口腔套
- 每种含消音等级 (1-5) 和强制张口标记
- **口水系统**：每回合累积 +5，最大 100，含脏乱/严重阈值和羞耻度加成

#### 手指约束系统
- **5 种类型**：拳套、掌形手套、手指分离器、指管约束、合掌束缚
- 每种定义 canGrip / canTouch / canType / canGesture 能力

#### 感官剥夺增强
- 触觉放大倍率 2.0x、空间迷失、时间扭曲
- **4 级剥夺**：单感官 → 双重 → 多重 → 完全剥夺
- 恢复视觉时触发感官过载（兴奋度飙升）

---

### 6. 生理状态系统

所有状态均为多级阈值系统，带随机叙事描写池：

| 系统 | 范围 | 分级 | 关键机制 |
|------|------|------|----------|
| **兴奋度** | 0-100 | 5 级（平静→临界）| 贞操锁阻止释放、刺激器（振动/电击）、5 种模式×4 种强度、临界时 alert-20 |
| **羞耻度** | 0-100 | 5 级（镇定→崩溃）| 暴露增量 (+5/+15/+25)、脱敏机制（达 60 后每回合 0.5 脱敏率） |
| **氧气** | 0-100 | 5 级（正常→濒临昏厥）| 5 种呼吸装置、密封氧气消耗、危险时强制俯卧、呼吸管 4 级流量控制 |
| **恐慌** | 0-100 | 5 级（平静→失控）| 密封/低氧/剥夺触发、首次封闭尖峰 +25、习惯度减免 50%、NPC 安抚 -10 |
| **习惯度** | 0-100 | 5 级（未适应→成瘾）| 每回合 +2、戒断阈值 40、戒断效应：兴奋度 +20 / alert-15 / 幻触 10 回合 |
| **身份侵蚀** | 0-100 | 5 级（人类→物体）| 乳胶覆盖≥91%触发、人称逐步物化（"你"→"它"→"这个橡胶物体"） |

#### 时长效应
- **姿势不适**：18 种姿势各有独立配置（起始回合、累积速率、最大不适值）
- **佩戴疲劳**：15 回合起，每回合 +1，最大 20

#### 困境束缚
- **6 种困境类型**：铃铛链、夹子连锁、平衡姿势、重物牵引、冰锁、滴蜡困境
- 每回合痛苦 +3，失败惩罚（兴奋 +10 / 服从 -5），成功奖励（服从 +3 / 好感 +2）

---

### 7. 乳胶封闭系统

13 个深度联动的子系统：

| 子系统 | 说明 |
|--------|------|
| **厚度** | 5 级：薄 0.3mm (触觉 1.5x) → 超厚 1.5mm (触觉 0.2x) → 液态 (触觉 2.0x) |
| **覆盖度** | 4 级：局部 (1-30%) → 半身 → 全身 → 完全密封 (91-100%) |
| **热量** | 5 级：凉爽→过热，每回合 +2，过热阈值 35 |
| **汗液** | 5 级：干燥→积水，影响灵敏度/挣扎滑脱/声音抑制 |
| **自紧** | 随热量自动收紧，5 级：松弛→碾压，每收紧 +1 兴奋 |
| **颜色** | 8 种（黑/红/白/粉/透明/银/紫/自定义），各有羞耻/侵蚀/隐蔽修正 |
| **开口** | 5 个位置 × 3 种状态（开放/拉合/锁定） |
| **层叠** | 最大 4 层，每层热量 ×1.5 / 触觉隔离 0.3 / 移动惩罚 0.15 |
| **护理** | 4 级光泽效果，抛光过程：羞耻 +8 / 服从 +5 |
| **气味** | 5 种场景叙事：新鲜 / 温热 / 汗味混合 / 密封 / 老化 |
| **液态乳胶** | 固化时间 5-10 分钟，挣扎抵抗 0.1，仅溶剂可移除 |
| **导电乳胶** | 7 个区域（灵敏度 0.6-2.5）× 4 级强度 × 4 种电流模式 |
| **充气系统** | 7 种装置（真空床/箱/充气口塞/塞/衣/头套/睡袋），最大 5 级 |

---

### 8. 角色扮演系统

#### PetPlay 宠物扮演
- **5 种角色**：小狗、小猫、兔子、小马、奶牛
- 每种含专属装备列表和行为规则
- 沉浸度系统：每回合 +3，说话 -20，打破沉浸 -15
- **5 级沉浸**：抗拒 → 别扭 → 适应中 → 沉浸 → 深层沉浸

#### 家具化
- **6 种角色**：桌子、脚凳、衣架、灯架、展品、座椅
- 每种含专属姿势和耐力消耗
- 崩溃惩罚：服从 -15 / 痛苦 +20 / 羞耻 +15
- 完美奖励：服从 +5 / 好感 +3

#### 身份侵蚀
- 乳胶覆盖度 ≥91% 时触发
- 5 级物化：人类 → 动摇 → 模糊 → 人偶 → 物体
- AI 叙述人称逐步降格

---

### 9. 训练与纪律系统

#### 纪律规则
- **9 条纪律规则**：称呼主人、禁止直视、禁止擅自说话、保持姿势、禁止反抗、立即服从、表示感谢、命令即跪、展示身体
- 3 级严重度：轻度 / 中度 / 重度

#### 惩罚与奖励
- **7 种惩罚**：口头警告、强制姿势、提升锁定、电击、缩短链条、兴奋度惩罚、延长佩戴
- **6 种奖励**：口头表扬、姿势释放、临时解锁、关闭刺激器、延长链条、休息时间

#### 训练系统
- **6 种训练类型**：姿势训练 (5 阶) / 口令训练 (4 阶) / 耐受训练 (6 阶) / 展示训练 (4 阶) / 侍奉训练 (5 阶) / 静默训练 (4 阶)
- 成功 +20 进度，失败 -10，最大 5 级
- 精通奖励：不适减少 30%，羞耻容忍度 +10

---

### 10. 打击与温度系统

#### 打击/鞭打
- **7 种工具**：手掌 / 拍子 / 鞭条 / 长鞭 / 藤条 / 马鞭 / 皮带（各有痛感/快感基数/留痕概率）
- **4 种痕迹**：红痕 (5 回合) / 鞭痕 (12) / 杖痕 (20) / 淤痕 (30)
- **6 个打击区域**：臀部 / 大腿 / 背部 / 胸部 / 脚底 / 手心（各有灵敏度和安全等级）
- 痛转快阈值 40，转化率 0.3

#### 温度游戏
- **6 种工具**：热蜡 (+25) / 冰块 (-20) / 温油 (+10) / 冰冷金属 (-15) / 热毛巾 (+15) / 薄荷膏 (-10)
- **8 个区域**：胸部 / 腹部 / 背部 / 大腿内侧 / 颈部 / 臀部 / 脚底 / 敏感区域
- 极值范围 -50~+50，每回合衰减 5

---

### 11. 监控系统

- **CCTV 警戒**：挣扎增量 +8 / AI 关键词 +4 / 每回合衰减 -2
- **4 级警觉**：低关注 (25) → 被注意 (50) → 高警戒 (75) → 即将介入 (100)
- 达到阈值时触发 NPC 安保介入，注入系统消息
- AI 叙述 30% 概率切换为冷冰冰的第三人称监控视角
- 冷却回合 5

---

### 12. 存储与安全

#### 双轨存储
- **自动探测 4 个候选 URL**：按优先级依次尝试，成功即锁定
- **运行时自动降级**：API 调用失败时透明切换到 localStorage
- **缓存破坏**：URL 末尾附加时间戳
- **RAG 自动清理**：存档保存时自动剔除临时 RAG 缓存

#### 后端安全
- 直接访问防护（`PLUGIN_DIR` 常量检查）
- 路径遍历防护（正则过滤 + 空值检查）
- 请求体 2MB 大小限制（双重校验）
- `delete_game` 强制 POST 方法
- 数据目录 `0700` 权限
- 错误信息不泄露内部细节

#### 图片压缩
- 分辨率缩放（≤1920px）
- JPEG 质量迭代压缩（0.9 → 0.1）
- 大小限制 2MB

---

### 13. 国际化

- **330+ 翻译键**，覆盖所有 UI 文本
- 17 个命名空间：按钮 / 编辑器 / 标签 / 占位符 / 选项 / 类型 / 状态 / 空状态 / 消息 / 提示 / 面板 / 侧边栏 / 游戏 / 章节 / 约束 / 挣扎 / 条件
- 支持模板变量：`{{name}}`, `{{level}}` 等
- 语言切换后实时重新渲染

---

## 安装

1. 将 `cyoa/` 目录复制到 Ada Chat 的 `plugins/` 文件夹
2. 确保 Web 服务器对 `cyoa/cyoa_games/` 目录可写（后端存储需要）
3. 在 Ada Chat 插件管理中启用 **CYOA 文字冒险游戏**

> 若后端不可用，插件会自动降级到 localStorage 模式，无需额外配置。

---

## 文件结构

```
cyoa/
├── manifest.json        # 插件清单（元数据、加载顺序）
├── cyoa-core.js         # 全局对象、CONFIG 常量（43 个系统定义）、工具函数
├── cyoa-data.js         # 数据管理：API 调用、localStorage、存档、图片压缩
├── cyoa-editor.js       # 游戏编辑器 UI（9 类元素、14 个分节）
├── cyoa-game.js         # 游戏引擎：AI 交互、状态管理、感官过滤、挣扎系统
├── cyoa-main.js         # 入口：插件注册、面板渲染、7 个侧边栏标签页
├── cyoa-i18n-zh.js      # 简体中文翻译字典（330+ 键）
├── backend.php          # 后端 CRUD（由 api.php 加载）
├── cyoa.css             # 样式（CSS 变量驱动，支持主题切换）
└── cyoa_games/          # 游戏数据目录（运行时创建）
```

---

## 后端 API

所有请求通过 Ada Chat 的 `api.php` 路由：

| Action | 方法 | 请求 | 响应 |
|--------|------|------|------|
| `save_game` | POST | JSON body `{id, name, ...}` | `{success: true, id}` |
| `load_game` | GET | `?id=xxx` | 完整游戏 JSON |
| `list_games` | GET | — | `{success: true, games: [...]}` |
| `delete_game` | POST | JSON body `{id}` | `{success: true}` |

---

## 游戏数据格式

```json
{
  "id": "game_1234567890",
  "name": "我的冒险",
  "author": "作者名",
  "version": "1.0",
  "synopsis": "游戏简介...",
  "worldSetting": {
    "background": "时代背景",
    "geography": "地理环境",
    "factions": "势力阵营",
    "socialStructure": "社会结构",
    "history": "历史事件"
  },
  "coreMechanics": { "type": "turn-based", "description": "..." },
  "narrator": { "enabled": true, "style": "emotional", "prompt": "..." },
  "attributes": [{ "id": "...", "name": "力量", "value": 10, "min": 0, "max": 100 }],
  "items": [{ "id": "...", "name": "钥匙", "itemType": "key", "quantity": 1 }],
  "equipment": [{ "id": "...", "name": "皮铐", "slots": ["wrist"], "material": "leather", "constraints": ["no_hands"], "lockLevel": 2 }],
  "skills": [{ "id": "...", "name": "潜行", "skillType": "passive", "level": 1 }],
  "quests": [{ "id": "...", "name": "逃离密室", "questType": "main", "objectives": ["找到钥匙", "打开门锁"] }],
  "characters": [{ "id": "...", "name": "主角", "roleType": "playable" }],
  "scenes": [{ "id": "...", "name": "地下室", "interactables": [] }],
  "chapters": [{ "id": "...", "title": "序章", "order": 1, "unlocked": true }]
}
```

---

## 配置

核心配置位于 `cyoa-core.js` 的 `CONFIG` 对象，主要配置项：

| 配置 | 说明 |
|------|------|
| `STORAGE_KEYS` | localStorage 键名 |
| `MEMORY_CONFIG` | 对话摘要策略（保留轮次、触发阈值、Token 预算） |
| `AROUSAL_*` | 兴奋度系统参数 |
| `STRUGGLE_CONFIG` | 挣扎系统参数（成功率、材质修正、锁定乘数） |
| `OBSERVER_ALERT_CONFIG` | 监控警觉度配置 |
| `LATEX_*` | 乳胶封闭系统参数 |
| `DEFAULT_WORD_FILTER` | 默认敏感词过滤规则 |
| `DEFAULT_GAME` | 新建游戏模板结构 |

---

## UI 面板

7 个侧边栏标签页，8 个背包子面板，18+ 个综合状态子面板：

| 标签页 | 内容 |
|--------|------|
| **剧情树** | 树形节点导航，点击跳转，节点摘要预览 |
| **属性** | 职业标签、监控警戒度指示器、属性网格（进度条+描述） |
| **背包** | 姿势牵引 / 兴奋度 / 纪律 / 习惯度 / 综合状态 / 装备栏 / 物品栏 / RAG 知识库 |
| **技能** | 技能卡片（等级/类型/熟练度进度条/效果倍率/消耗缩放） |
| **任务** | 按状态分组（进行中/可接取/已完成），目标清单+奖励列表 |
| **章节** | 当前章节详情、推进条件实时评估、章节流程列表 |
| **存档** | 保存/另存为/导出/导入/重命名/加载/删除 |

---

## 许可证

MIT License
